<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Document</title>
  </head>
  <body>
    <div class="main">
      <div class="container">
        <!-- <button id="btn">Generate random number</button>
        <div id="result"></div> -->

        <h1 class="title">TO-DO Î»</h1>
        <div class="add-task">
          <input type="text" id="input" placeholder="Programming with Haskell..."/>
          <button id="add" class="add">
            <svg width="54" height="52" viewBox="0 0 54 52" fill="none" xmlns="http://www.w3.org/2000/svg">
            <mask id="path-1-inside-1_3_47" fill="white">
            <path d="M27 0.0945282C41.7275 0.0945282 53.6667 11.499 53.6667 25.5672C53.6667 39.6352 41.7275 51.0398 27 51.0398C12.2724 51.0398 0.333344 39.6352 0.333344 25.5672C0.333344 11.499 12.2724 0.0945282 27 0.0945282ZM27 12.8308C25.9875 12.8308 25.1507 13.5496 25.0181 14.4821L25 14.7413V23.6567H15.6667C14.5621 23.6567 13.6667 24.5121 13.6667 25.5672C13.6667 26.5344 14.4191 27.3337 15.3953 27.4603L15.6667 27.4776H25V36.393C25 37.4481 25.8955 38.3035 27 38.3035C28.0125 38.3035 28.8493 37.5846 28.9819 36.6523L29 36.393V27.4776H38.3333C39.4379 27.4776 40.3333 26.6222 40.3333 25.5672C40.3333 24.6 39.5808 23.8006 38.6048 23.674L38.3333 23.6567H29V14.7413C29 13.6862 28.1045 12.8308 27 12.8308Z"/>
            </mask>
            <path d="M27 0.0945282C41.7275 0.0945282 53.6667 11.499 53.6667 25.5672C53.6667 39.6352 41.7275 51.0398 27 51.0398C12.2724 51.0398 0.333344 39.6352 0.333344 25.5672C0.333344 11.499 12.2724 0.0945282 27 0.0945282ZM27 12.8308C25.9875 12.8308 25.1507 13.5496 25.0181 14.4821L25 14.7413V23.6567H15.6667C14.5621 23.6567 13.6667 24.5121 13.6667 25.5672C13.6667 26.5344 14.4191 27.3337 15.3953 27.4603L15.6667 27.4776H25V36.393C25 37.4481 25.8955 38.3035 27 38.3035C28.0125 38.3035 28.8493 37.5846 28.9819 36.6523L29 36.393V27.4776H38.3333C39.4379 27.4776 40.3333 26.6222 40.3333 25.5672C40.3333 24.6 39.5808 23.8006 38.6048 23.674L38.3333 23.6567H29V14.7413C29 13.6862 28.1045 12.8308 27 12.8308Z" fill="#7858A6"/>
            <path d="M25.0181 14.4821L24.0281 14.3413L24.0231 14.3767L24.0206 14.4123L25.0181 14.4821ZM25 14.7413L24.0024 14.6715L24 14.7064V14.7413H25ZM25 23.6567V24.6567H26V23.6567H25ZM15.3953 27.4603L15.2667 28.452L15.299 28.4562L15.3316 28.4583L15.3953 27.4603ZM15.6667 27.4776L15.603 28.4756L15.6348 28.4776H15.6667V27.4776ZM25 27.4776H26V26.4776H25V27.4776ZM28.9819 36.6523L29.9719 36.7931L29.9769 36.7577L29.9794 36.7221L28.9819 36.6523ZM29 36.393L29.9976 36.4628L30 36.428V36.393H29ZM29 27.4776V26.4776H28V27.4776H29ZM38.6048 23.674L38.7334 22.6823L38.7011 22.6781L38.6685 22.6761L38.6048 23.674ZM38.3333 23.6567L38.397 22.6587L38.3652 22.6567H38.3333V23.6567ZM29 23.6567H28V24.6567H29V23.6567ZM27 1.09453C41.2189 1.09453 52.6667 12.094 52.6667 25.5672H54.6667C54.6667 10.904 42.2361 -0.905472 27 -0.905472V1.09453ZM52.6667 25.5672C52.6667 39.0402 41.2189 50.0398 27 50.0398V52.0398C42.2361 52.0398 54.6667 40.2302 54.6667 25.5672H52.6667ZM27 50.0398C12.781 50.0398 1.33334 39.0402 1.33334 25.5672H-0.666656C-0.666656 40.2301 11.7638 52.0398 27 52.0398V50.0398ZM1.33334 25.5672C1.33334 12.094 12.781 1.09453 27 1.09453V-0.905472C11.7638 -0.905472 -0.666656 10.904 -0.666656 25.5672H1.33334ZM27 11.8308C25.5175 11.8308 24.2345 12.8887 24.0281 14.3413L26.0082 14.6228C26.0668 14.2104 26.4575 13.8308 27 13.8308V11.8308ZM24.0206 14.4123L24.0024 14.6715L25.9976 14.8111L26.0157 14.5518L24.0206 14.4123ZM24 14.7413V23.6567H26V14.7413H24ZM25 22.6567H15.6667V24.6567H25V22.6567ZM15.6667 22.6567C14.0535 22.6567 12.6667 23.9171 12.6667 25.5672H14.6667C14.6667 25.107 15.0707 24.6567 15.6667 24.6567V22.6567ZM12.6667 25.5672C12.6667 27.0783 13.8342 28.2662 15.2667 28.452L15.5239 26.4686C15.0039 26.4012 14.6667 25.9904 14.6667 25.5672H12.6667ZM15.3316 28.4583L15.603 28.4756L15.7304 26.4796L15.459 26.4623L15.3316 28.4583ZM15.6667 28.4776H25V26.4776H15.6667V28.4776ZM24 27.4776V36.393H26V27.4776H24ZM24 36.393C24 38.0431 25.3869 39.3035 27 39.3035V37.3035C26.4041 37.3035 26 36.8531 26 36.393H24ZM27 39.3035C28.4826 39.3035 29.7655 38.2455 29.9719 36.7931L27.9918 36.5116C27.9332 36.9238 27.5425 37.3035 27 37.3035V39.3035ZM29.9794 36.7221L29.9976 36.4628L28.0024 36.3233L27.9843 36.5826L29.9794 36.7221ZM30 36.393V27.4776H28V36.393H30ZM29 28.4776H38.3333V26.4776H29V28.4776ZM38.3333 28.4776C39.9465 28.4776 41.3333 27.2172 41.3333 25.5672H39.3333C39.3333 26.0273 38.9293 26.4776 38.3333 26.4776V28.4776ZM41.3333 25.5672C41.3333 24.056 40.1656 22.8681 38.7334 22.6823L38.4762 24.6657C38.996 24.7332 39.3333 25.1439 39.3333 25.5672H41.3333ZM38.6685 22.6761L38.397 22.6587L38.2697 24.6547L38.5411 24.672L38.6685 22.6761ZM38.3333 22.6567H29V24.6567H38.3333V22.6567ZM30 23.6567V14.7413H28V23.6567H30ZM30 14.7413C30 13.0912 28.6132 11.8308 27 11.8308V13.8308C27.5959 13.8308 28 14.2812 28 14.7413H30Z" fill="#371B58" mask="url(#path-1-inside-1_3_47)"/>
            </svg>
          </button>
        </div>
        <div id="tasks" class="tasks"></div>
        <button id="clear-all">Clear all</button>
      </div>
    </main>

    <script>
      document.$CHAT_SOCKET = new WebSocket("ws://127.0.0.1:8000");
      document.$CHAT_SOCKET.onmessage = (event) => {
        let msg = JSON.parse(event.data);
        if (msg) {
          switch (msg.type) {
            case "task-added":
              document.getElementById("tasks").innerHTML += msg.value;
              break;
            case "clear-all":
              document.getElementById("tasks").innerHTML = "";
              break;
            case "task-removed":
              document.getElementById("tasks").innerHTML = document
                .getElementById("tasks")
                .innerHTML.replace(msg.value, ""); // FIXME: this is not a good way to remove a task
              break;
            default:
              console.log("Unknown message: " + event.data);
          }
        }
      };

      document.$CHAT_SOCKET.onopen = () => {
        console.log("Connected to server");
      };

      document.$CHAT_SOCKET.onclose = () => {
        console.log("Socket closed");
      };

      function stringifyEvent(type, value){
        return JSON.stringify({
          type: type,
          value: value,
        });
      };

      document.getElementById("clear-all").addEventListener("click", () => {
        document.$CHAT_SOCKET.send(stringifyEvent("clear-all", ""));
      });

      document.getElementById("add").addEventListener("click", () => {
        let task = document.getElementById("input").value;
        if (task) {
          document.$CHAT_SOCKET.send(stringifyEvent("add-task", task));
          document.getElementById("input").value = "";
          console.log("Sent task: ", {"type":"add-task", "value": task});
        }
        
      });
    </script>
  </body>
</html>
